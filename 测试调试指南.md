# 🧪 服务器管理系统测试调试指南

> 这是一个完整的测试指南，教你如何从零开始测试和调试服务器管理系统

## 📋 测试准备清单

在开始测试之前，请确保你有：

### ✅ 必需项目
- [ ] 一台Linux服务器（有公网IP）
- [ ] SSH私钥文件（luojie.pem）
- [ ] 服务器的root访问权限
- [ ] 本地电脑已安装Python 3.7+

### ✅ 可选项目
- [ ] GitHub账户（用于代码上传）
- [ ] 多个不同IP的服务器（测试迁移功能）

## 🚀 第一阶段：本地环境测试

### 步骤1：下载和设置项目

```bash
# 1. 下载项目
git clone https://github.com/你的用户名/server-management-system.git
cd server-management-system

# 2. 安装依赖
pip install -r requirements.txt

# 3. 检查Python版本
python --version  # 应该是3.7+
```

### 步骤2：PEM文件准备测试

```bash
# 测试自动PEM文件检测
python -c "
from connect.pem_handler import PEMHandler
handler = PEMHandler()
result = handler.find_pem_file_auto()
print(f'找到PEM文件: {result}')
"
```

**期望结果：**
- ✅ 如果找到：显示PEM文件路径
- ❌ 如果没找到：显示"未找到PEM文件"

**如果测试失败：**
1. 手动放置luojie.pem文件到以下位置之一：
   - Windows: `E:\server_connect\luojie.pem`
   - Linux/Mac: `~/.ssh/luojie.pem`
2. 重新运行测试

### 步骤3：GUI启动测试

```bash
# 启动图形界面
python 服务器管理器.py
```

**期望结果：**
- ✅ 弹出GUI窗口
- ✅ 左侧显示连接面板
- ✅ 右侧显示功能标签页
- ✅ 底部有日志输出

**如果GUI启动失败：**
```bash
# 检查tkinter是否安装
python -c "import tkinter; print('tkinter可用')"

# 如果提示错误，安装tkinter
# Ubuntu/Debian:
sudo apt-get install python3-tk

# CentOS/RHEL:
sudo yum install tkinter
```

## 🔌 第二阶段：连接测试（连接服务器之前）

### 步骤4：连接配置测试

在GUI中测试以下功能：

#### 4.1 PEM文件自动检测
1. 点击"自动"按钮
2. 观察日志输出

**期望结果：**
- ✅ 显示"✅ PEM文件已找到"
- ✅ PEM文件路径自动填入

#### 4.2 PEM文件手动选择
1. 点击"浏览"按钮
2. 选择你的luojie.pem文件

**期望结果：**
- ✅ 文件路径显示在输入框中
- ✅ 状态显示"✅ PEM文件已选择"

#### 4.3 连接预设保存
1. 填入测试IP（如：123.456.789.123）
2. 选择用户（root）
3. 确保PEM文件已选择
4. 点击"💾 保存连接"
5. 输入预设名称（如：测试服务器1）

**期望结果：**
- ✅ 显示"连接预设已保存"
- ✅ 生成配置文件`config/connection_presets.json`

### 步骤5：命令行工具测试

```bash
# 测试快速配置脚本
python quick_setup.py --help
```

**期望结果：**
```
usage: quick_setup.py [-h] [--ip IP] [--setup] [--users] [--docker]...
```

## 🌐 第三阶段：服务器连接测试

### 步骤6：实际服务器连接

#### 6.1 第一次连接（root用户）
1. 在GUI中输入真实的服务器IP
2. 选择用户：root
3. 确保PEM文件正确
4. 点击"🔗 连接服务器"

**期望结果：**
- ✅ 日志显示"🔌 正在连接服务器: root@IP"
- ✅ 日志显示"✅ 服务器连接成功！"
- ✅ 状态栏显示"🟢 已连接: IP"
- ✅ 服务器信息区域显示系统信息

**如果连接失败：**
1. 检查IP地址是否正确
2. 检查PEM文件是否对应该服务器
3. 确认服务器SSH服务是否启动：
   ```bash
   # 在服务器上运行
   sudo systemctl status ssh
   ```

#### 6.2 测试无PEM文件连接
1. 清空PEM文件路径
2. 尝试连接

**期望结果：**
- ⚠️ 应该显示"PEM文件验证失败，尝试无密钥连接..."
- 可能成功（如果服务器配置允许）或失败

## 🛠️ 第四阶段：服务器配置测试

### 步骤7：用户创建测试

连接成功后：

1. 切换到"🚀 服务器配置"标签页
2. 点击"创建用户 (luojie, heyi)"

**期望结果：**
- ✅ 日志显示"👥 开始创建用户..."
- ✅ 日志显示"✅ 用户创建完成"

**验证用户创建：**
1. 切换到"📝 日志输出"标签页
2. 点击"系统状态检查" → "查看用户信息"

**期望结果：**
```
👥 用户信息:
luojie:x:1001:1001::/home/luojie:/bin/bash
heyi:x:1002:1002::/home/heyi:/bin/bash
```

### 步骤8：Docker配置测试

1. 点击"配置Docker环境"
2. 等待安装完成（可能需要10-30分钟）

**期望结果：**
- ✅ 日志显示"🐳 开始配置Docker..."
- ✅ 日志显示"✅ Docker配置完成"

**验证Docker安装：**
1. 点击"系统状态检查" → "检查Docker状态"

**期望结果：**
```
🐳 Docker状态正常
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```

## 📁 第五阶段：项目管理测试

### 步骤9：项目添加和部署测试

#### 9.1 添加测试项目
1. 切换到"📁 项目管理"标签页
2. 在右侧填写：
   - 项目名称：`test-project`
   - GitHub URL：`https://github.com/用户名/测试仓库.git`
   - 分支：`main`
   - 描述：`测试项目`
3. 点击"➕ 添加项目"

**期望结果：**
- ✅ 项目出现在左侧列表中
- ✅ 状态显示"未部署"

#### 9.2 项目部署测试
1. 选择刚添加的项目
2. 点击"🚀 部署项目"

**期望结果：**
- ✅ 日志显示部署过程
- ✅ 项目状态变为"已部署"

## 💾 第六阶段：备份功能测试

### 步骤10：备份创建和恢复测试

#### 10.1 创建备份
1. 切换到"💾 备份管理"标签页
2. 选择要备份的项目
3. 选择备份类型：`code`
4. 点击"💾 创建备份"

**期望结果：**
- ✅ 日志显示备份过程
- ✅ 备份出现在列表中
- ✅ 本地生成备份文件

#### 10.2 验证备份文件
```bash
# 检查备份目录
ls -la backups/项目名称/
```

**期望结果：**
- ✅ 看到.tar.gz备份文件
- ✅ 看到.json信息文件

## 🧪 第七阶段：系统稳定性测试

### 步骤11：压力测试

#### 11.1 多次连接测试
1. 断开连接
2. 重新连接
3. 重复5次

#### 11.2 大文件备份测试
1. 在服务器上创建大文件：
   ```bash
   # 在服务器上运行
   dd if=/dev/zero of=/home/shared/projects/test-project/large_file.dat bs=1M count=100
   ```
2. 创建备份，观察是否正常

#### 11.3 错误恢复测试
1. 输入错误的IP地址，测试错误处理
2. 删除PEM文件，测试错误提示
3. 在无网络情况下测试

## 🔧 调试技巧

### 调试日志
在程序目录下查看详细日志：
```bash
# 查看连接日志
cat logs/connection.log

# 查看部署日志  
cat logs/deployment.log
```

### 常见问题排查

#### 问题1：PEM文件找不到
```bash
# 检查PEM文件位置
find / -name "luojie.pem" 2>/dev/null

# 验证PEM文件格式
head -1 你的PEM文件路径
# 应该看到：-----BEGIN xxx PRIVATE KEY-----
```

#### 问题2：连接被拒绝
```bash
# 在服务器上检查SSH服务
sudo systemctl status ssh
sudo netstat -tlnp | grep :22

# 检查防火墙
sudo ufw status
```

#### 问题3：权限问题
```bash
# 修复PEM文件权限
chmod 600 luojie.pem

# 检查服务器用户权限
id luojie
groups luojie
```

## 📊 测试报告模板

完成测试后，记录结果：

```
测试日期：2024-XX-XX
测试环境：Windows 10 / Ubuntu 20.04
服务器：阿里云 / 腾讯云 / AWS

功能测试结果：
✅ PEM文件自动检测 - 通过
✅ 服务器连接 - 通过  
✅ 用户创建 - 通过
✅ Docker配置 - 通过
✅ 项目部署 - 通过
✅ 备份功能 - 通过

性能测试：
- 连接时间：< 10秒
- 用户创建时间：< 2分钟
- Docker安装时间：< 30分钟
- 项目部署时间：< 5分钟
- 备份时间：< 1分钟（代码备份）

问题记录：
1. [如果有问题，在这里记录]
2. [解决方案]

总体评价：系统运行正常 ✅
```

## 🎯 成功标准

如果所有测试都通过，你应该能够：

1. ✅ 在任何电脑上启动管理系统
2. ✅ 自动找到或手动选择PEM文件
3. ✅ 成功连接到服务器
4. ✅ 创建luojie和heyi用户
5. ✅ 安装和配置Docker
6. ✅ 部署GitHub项目
7. ✅ 创建和管理备份
8. ✅ 在不同服务器间迁移项目

**恭喜！🎉 你的服务器管理系统已经完全可用了！** 